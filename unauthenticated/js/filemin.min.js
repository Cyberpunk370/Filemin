var Filemin=function(){var e=this;this.tabs=[];this.tabcounter=0;this.previousTabId="";this.currentTabId="";this.activeTab=function(){var e=$("#tabs-control").find("li.active a").attr("href");var t=this.tabs.map(function(e){return e.id}).indexOf(e);return this.tabs[t]};this.getTab=function(e){var t=this.tabs.map(function(e){return e.id}).indexOf(e);return this.tabs[t]};this.delTab=function(e){var t=this.tabs.map(function(e){return e.id}).indexOf(e);if(t>=0){this.tabs.splice(t,1)}};this.listTableOptions={classes:"table table-condensed table-hover table-no-bordered",search:true,showColumns:true,showPaginationSwitch:true,clickToSelect:true,maintainSelected:true,cookie:true,selectItemName:"name",striped:"true",minimumCountColumns:0,height:$(window).height()-158,formatSearch:function(){return text.table_Search},formatNoMatches:function(){return text.table_NoMatches},columns:[{checkbox:true},{field:"name",title:text.name,switchable:false,sortable:true,width:"500px","class":"column-field-name",formatter:function(e,t,a){var i=t.type.replace("/","-");if(t.symlink){if(t.symlink=="broken"){i="broken"}return'<img src="images/icons/mime/'+i+'.png" class="pull-left"> <span class="name-column-link" rel="tooltip" title="'+t.link_target+'">'+escapeHTML(e)+"</span>"}else{return'<img src="images/icons/mime/'+i+'.png" class="pull-left"> <span class="name-column-link">'+escapeHTML(e)+"</span>"}},events:{"click .name-column-link":function(t,a,i,r){var n="#"+$(this).parents(".filemin-tab").attr("id");var s=e.getTab(n);if(i.symlink=="broken"){showError(null,text.broken_symlink)}else if(i.directory){$(this).parents(".list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(s.path+"/"+i.name)})}else if(isEditable(i.type,i.name)||isEditable(i.link_target_mime,i.link_target)){editFile(s.path,i.name,++e.tabcounter)}else if(i.type.indexOf("image")>-1||i.link_target_mime.indexOf("image")>-1){viewImage(s.path,i.name)}else if(i.archive){listArchive(s.path,i.name)}else{downloadSingle(s.path,i.name)}t.stopPropagation()}}},{field:"type",title:text.type,sortable:true},{field:"user",title:text.owner_user,sortable:true,formatter:function(e,t,a){return t.user+":"+t.group}},{field:"permissions",title:text.permissions,sortable:true},{field:"size",title:text.size,sortable:true,formatter:function(e,t,a){return bytesToSize(e)}},{field:"selinux_context",title:"SELinux",sortable:true},{field:"mtime",title:text.last_mod_time,sortable:true,formatter:function(e,t,a){return convertTimestamp(e)}}],onCheckAll:function(){var t=e.activeTab();$(t.id+" .list-table").find("tr[data-index]").addClass("selected")},onUncheckAll:function(){var t=e.activeTab();$(t.id+" .list-table").find("tr.selected").removeClass("selected")},onContextMenuRow:function(t,a){var i=e.activeTab();if(!checkSelected(i)){$(a).addClass("success")}},responseHandler:function(t){var a=this.data;if(t.error){showError(null,t.error);return a}else{e.updateTab(this,t);return t}},onLoadError:function(e,t){new PNotify({icon:"fa fa-exclamation-circle",type:"error",title:text.error_title,text:e+" "+t})},contextMenu:"#context-menu",beforeContextMenuRow:function(t,a){var i=$(this).closest(".list-table");var r=$(i).closest(".filemin-tab");var n=r.attr("id");var s=e.getTab(n);var o=$(t.currentTarget).data("index");if(isEditable(a.type,a.name)||isEditable(a.link_target_mime,a.link_target)||a.symlink){$('#context-menu [ data-item="edit" ]').show()}else{$('#context-menu [ data-item="edit" ]').hide()}if(a.archive){$('#context-menu [ data-item="extract" ]').show()}else{$('#context-menu [ data-item="extract" ]').hide()}if(a.type.indexOf("image")>-1||a.link_target_mime.indexOf("image")>-1){$('#context-menu [ data-item="view" ]').show()}else{$('#context-menu [ data-item="view" ]').hide()}i.bootstrapTable("showContextMenu",{event:t}).off("contextmenu-item.bs.table").on("contextmenu-item.bs.table",function(t,a,i){var r=e.activeTab();$(r.id+" .list-table").find(".success").removeClass("success");switch(i.data("item")){case"rename":rename(r,a.name);break;case"view":viewImage(r.path,a.name);break;case"edit":if(isEditable(a.type,a.name)||isEditable(a.link_target_mime,a.link_target)){editFile(r.path,a.name,++e.tabcounter)}else if(a.symlink){editSymlink(r,a)}break;case"extract":extract(r,a.name);break;case"create_file":createFile(r);break;case"create_folder":createFolder(r);break;case"copy_selected":copySelected(r,a.name);break;case"cut_selected":cutSelected(r,a.name);break;case"paste":paste(r);break;case"symlink":pasteSymlink(r);break;case"view-buffer":viewBuffer();break;case"select_all":$(this).bootstrapTable("checkAll");break;case"select_none":$(this).bootstrapTable("uncheckAll");break;case"select_inverse":$(this).bootstrapTable("checkInvert");break;case"properties":changeProperties(r,a);break;case"get_sizes":var n=showWait(text.notice_take_while);$(this).bootstrapTable("refresh",{url:"list.cgi?path="+filemin.activeTab().path+"&sizes=1"}).on("load-success.bs.table load-error.bs.table",function(){n.remove()});break;case"chmod_selected":chmodSelected(r,a);break;case"chown_selected":chownSelected(r,a);break;case"chcon_selected":chconSelected(r,a);break;case"compress_selected":compressSelected(r,a);break;case"download_selected":downloadSelected(r,a);break;case"search":search(r.path);break;case"delete":deleteSelected(r,a.name);break}});return false}};this.searchTableOptions={cookie:false,formatNoMatches:function(){return text.table_search_NoMatches},columns:[{checkbox:true},{field:"name",title:text.name,switchable:false,sortable:true,width:"740px","class":"column-field-name",formatter:function(e,t,a){var i=t.type.replace("/","-");if(t.symlink){if(t.symlink=="broken"){i="broken"}return'<img src="images/icons/mime/'+i+'.png" class="pull-left"> <span class="name-column-link" rel="tooltip" title="'+t.link_target+'">'+e+"</span>"}else{return'<img src="images/icons/mime/'+i+'.png" class="pull-left"> <span class="name-column-link">'+e+"</span>"}},events:{"click .name-column-link":function(t,a,i,r){var n="#"+$(this).parents(".filemin-tab").attr("id");var s=e.getTab(n);var o=i.name.split("/");var l=o.pop();o=s.path+"/"+o.join("/");if(i.symlink=="broken"){showError(null,text.broken_symlink)}else if(i.directory){e.newTab("navigator",s.path+"/"+i.name);$("#tabs-control a:last").tab("show")}else if(isEditable(i.type,i.name)||isEditable(i.link_target_mime,i.link_target)){editFile(o,l,++e.counter)}else if(i.type.indexOf("image")>-1||i.link_target_mime.indexOf("image")>-1){viewImage(o,l)}else if(i.archive){listArchive(o,l)}t.stopPropagation()}}},{field:"type",title:text.type,sortable:true},{field:"user",title:text.owner_user,sortable:true,formatter:function(e,t,a){return t.user+":"+t.group}},{field:"permissions",title:text.permissions,sortable:true},{field:"size",title:text.size,sortable:true,formatter:function(e,t,a){return bytesToSize(e)}},{field:"selinux_context",title:"SELinux",sortable:true},{field:"mtime",title:text.last_mod_time,sortable:true,formatter:function(e,t,a){return convertTimestamp(e)}}],responseHandler:function(t){var a=this.data;if(t.error){showError(null,t.error);return a}else{e.updateTab(this,t);return t}},contextMenu:"#context-menu-search",beforeContextMenuRow:function(t,a){var i=$(this).closest(".list-table");var r=$(i).closest(".filemin-tab");var n=r.attr("id");var s=e.getTab(n);var o=$(t.currentTarget).data("index");if(!a.directory){$('#context-menu-search [ data-item="open_containing"]').show();$('#context-menu-search [ data-item="open_folder"]').hide()}else{$('#context-menu-search [ data-item="open_containing"]').hide();$('#context-menu-search [ data-item="open_folder"]').show()}if(isEditable(a.type,a.name)||isEditable(a.link_target_mime,a.link_target)){$('#context-menu-search [ data-item="edit" ]').show()}else{$('#context-menu-search [ data-item="edit" ]').hide()}if(a.type.indexOf("image")>-1||a.link_target_mime.indexOf("image")>-1){$('#context-menu-search [ data-item="view" ]').show()}else{$('#context-menu-search [ data-item="view" ]').hide()}i.bootstrapTable("showContextMenu",{event:t}).off("contextmenu-item.bs.table").on("contextmenu-item.bs.table",function(t,a,i){var r=e.activeTab();$(r.id+" .list-table").find(".success").removeClass("success");var n=a.name.split("/");var s=n.pop();n=r.path+"/"+n.join("/");switch(i.data("item")){case"view":viewImage(n,s);break;case"edit":if(isEditable(a.type,a.name)||isEditable(a.link_target_mime,a.link_target)){editFile(n,s,++e.counter)}break;case"copy_selected":copySelected(r,a.name);break;case"cut_selected":cutSelected(r,a.name);break;case"view-buffer":viewBuffer();break;case"select_all":$(this).bootstrapTable("checkAll");break;case"select_none":$(this).bootstrapTable("uncheckAll");break;case"select_inverse":$(this).bootstrapTable("checkInvert");break;case"chmod_selected":chmodSelected(r,a);break;case"chown_selected":chownSelected(r,a);break;case"chcon_selected":chconSelected(r,a);break;case"open_containing":e.newTab("navigator",n);$("#tabs-control a:last").tab("show");break;case"open_folder":e.newTab("navigator",n);$("#tabs-control a:last").tab("show");break}});return false}}};Filemin.prototype.newTab=function(e,t,a){this.tabcounter++;id="#"+e+"-"+this.tabcounter;if(a===undefined){a="listTable"+Math.random()}var i;switch(e){case"navigator":i="fa-folder-open-o";break;case"search":i="fa-search";break}$("#tabs-control").append($('<li class="tab"><a class="closable" data-toggle="tab" href="'+id+'"><i class="fa '+i+'"></i> '+'<span class="tab-title"></span>'+' <button class="btn btn-xs btn-warning close-tab pull-right" type="button" '+'title="'+text.close_tab+'"><i class="fa fa-close"></i></button>'+"</a></li>"));$("#tabs-container").append($('                <div class="tab-pane fade filemin-tab" id="'+id.substring(1)+'">                </div>'));$("#tabs-container "+id).append('            <div class="filemin-table pull-left">                <ol class="breadcrumb pull-left">                    <li><a>'+root_icon+'</a></li>                </ol>                <button type="button" class="btn btn-default path-edit"><i class="fa fa-edit"></i></button>                <table class="list-table"></table>            </div>        ');var r={id:id,path:t?t:"",type:e,cookieId:a,stats:{total:0,files:0,dirs:0,size:""}};this.tabs.push(r);switch(e){case"navigator":var n=$.extend({},this.listTableOptions,{toolbar:r.id+" .breadcrumb",cookieIdTable:a});if(t===undefined){$.extend(true,n,{url:"list.cgi"})}else{$.extend(true,n,{url:"list.cgi?path="+encodeURIComponent(t)})}$(r.id+" .list-table").bootstrapTable(n);break;case"search":var s=$.extend(true,{},this.listTableOptions);$.extend(true,s,this.searchTableOptions);s.url=t;s.toolbar=r.id+" .breadcrumb",$(r.id+" .list-table").bootstrapTable(s);$("#tabs-control a:last").tab("show");break}return r};Filemin.prototype.getTabsByPath=function(e){var t=[];for(i=0;i<this.tabs.length;i++){if(this.tabs[i].path==e){t.push(this.tabs[i])}}return t};Filemin.prototype.updateTab=function(e,t){var a=e.toolbar.split(" ")[0];var r=getQueryPathParam(e.url);var n=$("#tabs-control").find('a[href="'+a+'"]');var s=this.tabs.map(function(e){return e.id}).indexOf(a);this.tabs[s].path=r;this.tabs[s].stats=countStats(t);ol=$(a).find(".breadcrumb");ol.children().slice(1).remove();var o=r.split("/");$.each(o.slice(1),function(e,t){ol.append("<li><a>"+escapeHTML(t)+"</a></li>")});if(this.tabs[s].type=="navigator"){t=t.filter(function(e){return e.directory});var l=t.map(function(e){return{title:escapeHTML(e.name),key:r+"/"+e.name,folder:true}});var c=$("#filemin-tree .tree").data("ui-fancytree").getTree();var d;i;var f=r.split("/").slice(1);var b="";var u=r;if(f.length>0){$.each(f,function(e,t){b="/"+f.slice(0,f.length-e).join("/");d=c.getNodeByKey(b);if(d!==null){u=u.replace(b,"");f=u.split("/").slice(1);$.each(f,function(e,t){var a;b+="/"+t;a=d.addChildren([{title:escapeHTML(t),key:b,folder:true}]);d.sortChildren();d=a});return false}})}if(d===null||d===undefined){d=c.getRootNode()}for(i=0;i<l.length;i++){if(c.getNodeByKey(l[i].key)===null){d.addChildren(l[i])}}var h=[];$.each(d.getChildren(),function(e,t){var a=l.map(function(e){return e.key}).indexOf(t.key);if(a<0){h.push(t)}});$.each(h,function(e,t){d.removeChild(t)});d.sortChildren();if(!d.isRootNode()){d.setActive(true,{noEvents:true});d.makeVisible();d.setExpanded(true,{noAnimation:true})}}$(n).children(".tab-title").html(escapeHTML(o[o.length-1]));$(n).attr("data-original-title",escapeHTML(r)).tooltip({trigger:"hover",placement:"bottom",html:true});$("#bottom-stats").html(text.toolbar_files+": "+this.tabs[s].stats.files+" | "+text.toolbar_folders+": "+this.tabs[s].stats.dirs+" | "+text.toolbar_total+": "+this.tabs[s].stats.total+" | "+this.tabs[s].stats.size)};$(document).ready(function(){CodeMirror.modeURL="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.14.2/mode/%N/%N.min.js";var e={dir1:"up",dir2:"left",firstpos1:10,firstpos2:10};PNotify.prototype.options.stack=e;PNotify.prototype.options.styling="brighttheme";PNotify.prototype.options.delay=4e3;PNotify.prototype.options.addclass="stack-bottomright filemin";filemin=new Filemin;$("#filemin-tree .tree").fancytree({source:[],extensions:["glyph","filter"],glyph:{map:{folder:"fa fa-folder-o",folderOpen:"fa fa-folder-open-o",expanderClosed:"fa  fa-caret-right",expanderOpen:"fa  fa-caret-down"}},filter:{fuzzy:false,highlight:false,mode:"hide"},toggleEffect:false,activate:function(e,t){if(!t.node.isRootNode()){$(filemin.activeTab().id).find(".list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(t.node.key)})}}});$("#filemin-tree").resizable({handles:"e",minWidth:55,maxWidth:500});$("ul.fancytree-container").height($(window).height()-214);$.get("load_session.cgi").done(function(e){if(!e.error){showSuccess(null,text.session_loaded);var t=$("#filemin-tree .tree").fancytree("getTree");var a=t.getRootNode();a.addChildren(e.tree);$.each(e.tabs,function(e,t){filemin.newTab("navigator",t.path,t.cookieId)})}else{showNotice(null,text.no_session_found);filemin.newTab("navigator")}$("#tabs-control a:eq("+e.active+")").tab("show")}).fail(function(e,t,a){showError(t.error_title,t)});$("#tabs-container").on("click",".breadcrumb > li > a",function(){var e=$(this).closest(".filemin-tab").attr("id");if(e.indexOf("search")==-1){var t=$(this).parent();var a=t.parent();var i=t.index();var r="";$.each(a.children().find("a").slice(1,i+1),function(e,t){r+="/"+t.textContent});var n=filemin.activeTab();$(n.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(r)})}});$("#main-menu").on("click","a",function(){if($(this).parent().hasClass("disabled")){return false}var e=filemin.activeTab();switch($(this).data("item")){case"upload_files":$("#fileupload").click();break;case"get_from_url":getFromUrl(e);break;case"create_file":createFile(e);break;case"create_folder":createFolder(e);break;case"copy_selected":copySelected(e);break;case"cut_selected":cutSelected(e);break;case"paste":paste(e);break;case"symlink":pasteSymlink(e);break;case"view-buffer":viewBuffer();break;case"get_sizes":var t=$(e.id+" .list-table");var a=showWait(text.notice_take_while);t.bootstrapTable("refresh",{url:"list.cgi?path="+e.path+"&sizes=1"}).on("load-success.bs.table load-error.bs.table",function(){a.remove()});break;case"chmod_selected":if(checkSelected(e)){chmodSelected(e)}break;case"chown_selected":if(checkSelected(e)){chownSelected(e)}break;case"chcon_selected":if(checkSelected(e)){chconSelected(e)}break;case"compress_selected":if(checkSelected(e)){compressSelected(e)}break;case"search":search(e.path);break;case"bookmark":bookmark(e);break;case"manage_bookmarks":manageBookmarks();break;case"goto":$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent($(this).text())});break}});$("#fileupload").fileupload({dataType:"json",done:function(e,t){var a=filemin.getTabsByPath(t.path);for(i=0;i<a.length;i++){if(a[i].path==t.path){$(a[i].id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(a[i].path)})}}t.tracker.get().find("div.progress").hide();if(t.result.error){waitToError(t.tracker,null,t.result.error)}else if(t.result.success){waitToSuccess(t.tracker,text.upload_success,t.files[0].name)}},fail:function(e,t){t.tracker.get().find("div.progress").hide();if(t.errorThrown=="abort"){waitToNotice(t.tracker,text.upload_cancelled,t.files[0].name)}else{waitToError(t.tracker,text.error_title,t.textStatus)}var a=filemin.getTabsByPath(t.path);for(i=0;i<a.length;i++){if(a[i].path==t.path){$(a[i].id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(a[i].path)})}}},add:function(e,t){var a=filemin.activeTab();$.post("check_exists.cgi",{path:a.path,name:t.files[0].name}).done(function(e){if(e.exists){if(e.directory){showNotice(text.warning_title,t.files[0].name+" "+text.error_exists_and_dir)}else{new PNotify({type:"notice",icon:"fa fa-question-circle",title:text.warning_title,text:e.notice,hide:false,buttons:{closer:false,sticker:false},history:{history:false},confirm:{confirm:true}}).get().on("pnotify.confirm",function(){t.url="upload.cgi?path="+encodeURIComponent(a.path);t.url+="&overwrite=1";t.hJQX=t.submit()})}}else{t.url="upload.cgi?path="+encodeURIComponent(a.path);t.hJQX=t.submit()}}).fail(function(e,t,a){showError(null,t)})},submit:function(e,t){t.path=filemin.activeTab().path;t.tracker=new PNotify({title:text.uploading+" "+t.files[0].name,text:'                <div class="progress active" style="margin:0">                    <div class="progress-bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0">                        <span class="sr-only">0%</span>                    </div>                </div><p></p>                <button class="btn btn-xs btn-warning pull-right">'+text.dialog_cancel+"</button>",icon:"fa fa-spinner fa-spin",hide:false,buttons:{closer:false,sticker:false},history:{history:false},after_init:function(e){e.elem.on("click","button",function(){t.hJQX.abort()})}})},progress:function(e,t){var a=parseInt(t.loaded/t.total*100,10);t.tracker.get().find("div.progress-bar").css("width",a+"%");t.tracker.get().find("div.progress-bar").html(a+"% "+(t.bitrate/(8192*1024)).toFixed(2)+"MB/s")}});$("#tabs-control").on("click"," li a .close-tab",function(){var e=this;var t=$(this).parents("li").children("a").attr("href");var a=$(this).parents("li");var r=$(this).parents("ul").children("li").index(a);r=r<2?2:r;if($(this).hasClass("btn-danger")){bootbox.dialog({title:text.file_not_saved,message:text.really_close,buttons:{save:{label:text.save_close,className:"btn-success",callback:function(){var a=$("#tabs-container "+t+' form[name="edit-file"]')[0];a.data.value=a.editor.getValue();var n=$(a).serializeArray();var s=showWait(text.notice_saving);$.post("save_file.cgi",n).done(function(n){if(n.success){waitToSuccess(s,text.saved_successfully,a.name.value);var o=filemin.getTabsByPath(a.path.value);var l="list.cgi?path="+encodeURIComponent(a.path.value);for(i=0;i<o.length;i++){if(o[i].path==a.path.value){$(o[i].id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(a.path.value)})}}$(e).parents("li").remove("li");$(t).remove();$($("#tabs-control a")[r-1]).tab("show")}else{waitToError(s,text.error_title,n.error)}var c=$(e).parents(".filemin-tab").attr("id");$('a[href="#'+c+'"]').find("button").removeClass("btn-danger").addClass("btn-success")}).fail(function(e,t,a){waitToError(t.error_title,t)})}},close:{label:text.close_tab,className:"btn-danger",callback:function(){$(e).parents("li").remove("li");$(t).remove();if(t==filemin.currentTabId){if($(filemin.previousTabId).length){$('a[href="'+filemin.previousTabId+'"]').tab("show")}else{$($("#tabs-control a")[r-1]).tab("show")}}}},cancel:{label:text.dialog_cancel,className:"btn-primary pull-right"}}})}else{$(this).parents("li").remove("li");$(t).remove();if(t==filemin.currentTabId){if($(filemin.previousTabId).length){$('a[href="'+filemin.previousTabId+'"]').tab("show")}else{$($("#tabs-control a")[r-1]).tab("show")}}filemin.delTab(t)}if($("#tabs-control li").length==0){var n=$("#bottom-panel");n.hide("slide",{direction:"down"},100);var s=$("#filemin-tree");s.hide("slide",{direction:"left"},100)}});$("#tabs-container").on("click",'form[name="edit-file"] button[name="save"]',function(e){e.preventDefault();var t=$(this)[0];var a=t.form;a.data.value=a.editor.getValue();var r=$(a).serializeArray();var n=showWait(text.notice_saving);$.post("save_file.cgi",r).done(function(e){n.remove();if(e.success){waitToSuccess(n,text.saved_successfully,a.name.value);var r=filemin.getTabsByPath(a.path.value);var s="list.cgi?path="+encodeURIComponent(a.path.value);for(i=0;i<r.length;i++){if(r[i].path==a.path.value){$(r[i].id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(a.path.value)})}}}else{waitToError(n,text.error_title,e.error)}var o=$(t).parents(".filemin-tab").attr("id");$('a[href="#'+o+'"]').find("button").removeClass("btn-danger").addClass("btn-success")}).fail(function(e,t,a){waitToError(n,null,t)})});$("#tabs-container").on("click",'form[name="edit-file"] button[name="reload"]',function(e){e.preventDefault();var t=showWait(text.table_LoadingMessage);var a=$(this)[0];var i=a.form;$.ajax({url:"get_file_contents.cgi?path="+encodeURIComponent(i.path.value)+"&name="+encodeURIComponent(i.name.value),dataType:"text",type:"GET",async:true}).done(function(e){i.data.value=e;i.editor.setValue(e);var r="#"+$(a).parents(".filemin-tab").attr("id");$('a[href="'+r+'"]').find("button").removeClass("btn-danger").addClass("btn-success");t.remove()}).fail(function(e,a,i){waitToError(t,null,a)})});$(document).on("click",".path-edit",function(){$(this).popover({html:true,trigger:"manual",content:function(){return'                <div class="input-group">                    <input id="path" type="text" class="form-control input-sm" value="'+filemin.activeTab().path+'">                    <span class="input-group-btn">                        <button id="go" class="btn btn-success btn-sm" type="button"><i class="fa fa-check"></i></button>                    </span>                </div>'}});$(this).popover("toggle");$("#path").focus()});$(document).on("click","#go",function(){var e=$("#path").val();if(e.substr(-1)==="/"){e=e.substr(0,e.length-1)}$(".path-edit").popover("hide");var t=filemin.activeTab();$(t.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e)})});$(document).on("keydown","#path",function(e){if(e.which==13){$("#go").click()}e.stopPropagation()});$.each(["show","hide"],function(e,t){var a=$.fn[t];$.fn[t]=function(){this.trigger(t);return a.apply(this,arguments)}});$("#context-menu").on("hide",function(){var e=filemin.activeTab();$(e.id+" .list-table").find(".success").removeClass("success")});$("#context-menu-search").on("hide",function(){var e=filemin.activeTab();$(e.id+" .list-table").find(".success").removeClass("success")});$("#new-tab").click(function(e){var t=filemin.newTab("navigator");$("#tabs-control a:last").tab("show")});$("body").tooltip({selector:"[rel='tooltip']",placement:"right",container:"body"});$(document).on('a[data-toggle="tab"] shown.bs.tab',function(e){filemin.previousTabId=filemin.currentTabId;filemin.currentTabId=$(e.target).attr("href");panelResize(e)});$("#tabs-control").sortable()});$(document).on("resize","#filemin-tree",function(e,t){var a=t.element;var i=$("#tabs-container");var r=$(".container-fluid").width();i.width(r-a.outerWidth(true));i.find(".list-table").bootstrapTable("resetView")});$(document).on("keyup","input[name='tree-filter']",function(e){var t=$(this).val();var a=$("#filemin-tree .tree").fancytree("getTree");if(e&&e.which===$.ui.keyCode.ESCAPE||$.trim(t)===""){$("input[name='tree-filter']").val("");a.clearFilter();return}if(t===""){a.clearFilter()}else{a.filterNodes(t,{})}});$(document).on("click","button[name='reset-tree-filter']",function(e){var t=$("#filemin-tree .tree").fancytree("getTree");$("input[name='tree-filter']").val("");t.clearFilter()});$(document).on("click","#hide-tree",function(e){if($(this).hasClass("disabled")){return false}var t=$("#filemin-tree");var a=$("#tabs-container");var i=$(".container-fluid").width();if(t.is(":hidden")){a.width(i-t.outerWidth(true));a.find(".list-table").bootstrapTable("resetView")}t.toggle("slide",{direction:"left"},100,function(){if(t.is(":hidden")){a.width(i)}a.find(".list-table").bootstrapTable("resetView")});var r=$(this).attr("value")==="true"?true:false;$(this).attr("value",!r)});$(document).on("click","#close-all",function(e){var t=$("#filemin-tree .tree").fancytree("getTree");$("#filemin-tree .tree").fancytree("getRootNode").visit(function(e){e.setExpanded(false)})});$(document).on("click","#open-all",function(e){var t=$("#filemin-tree .tree").fancytree("getTree");$("#filemin-tree .tree").fancytree("getRootNode").visit(function(e){e.setExpanded(true)})});$(document).on("keydown",".bootbox.modal input",function(e){if(e.which==13){$(".bootbox button[data-bb-handler='confirm']").trigger("click");e.preventDefault()}});$(window).on("beforeunload",function(){var e=$("#filemin-tree .tree").fancytree("getTree");var t=[];$.each(filemin.tabs,function(e,a){if(a.type=="navigator"){t.push(a)}});$.ajax({type:"POST",async:false,url:"save_session.cgi",data:{data:JSON.stringify({tabs:t,tree:e.toDict(),active:$("#tabs-control li.active").index()})}})});var resizeId;$(window).resize(function(){clearTimeout(resizeId);resizeId=setTimeout(panelResize,300)});function panelResize(e){var t;if(e!==undefined){t=$(e.target).attr("href")}else{t=$("#tabs-control .active a").attr("href")}var a=$("#filemin-tree");var i=$("#tabs-container");var r=$("#bottom-panel");var n=$(".container-fluid").width();var s=$("body").height()-158;var o=filemin.activeTab();switch(true){case/editor/.test(t):disableForEdit();r.hide("slide",{direction:"down"},100);a.hide("slide",{direction:"left"},100);i.width(n);$(t+" .CodeMirror").height($(window).height()-163);break;case/search/.test(t):disableForSearch();$("#hide-tree").addClass("disabled");r.show("slide",{direction:"down"},100);a.hide("slide",{direction:"left"},100,function(){i.width(n);$(t+" .filemin-table").height(s);$(t+" .filemin-table .list-table").bootstrapTable("resetView",{height:s})});$("#bottom-stats").html(text.toolbar_files+": "+o.stats.files+" | "+text.toolbar_folders+": "+o.stats.dirs+" | "+text.toolbar_total+": "+o.stats.total+" | "+o.stats.size);break;case/navigator/.test(t):$("#main-menu .nav li").removeClass("disabled");$("#hide-tree").removeClass("disabled");r.show("slide",{direction:"down"},100);if($("#hide-tree").attr("value")=="false"){i.width(n-a.outerWidth(true));$("ul.fancytree-container").height($(window).height()-214);$(t+" .filemin-table").height(s);$(t+" .filemin-table .list-table").bootstrapTable("resetView",{height:s});a.show("slide",{direction:"left"},100);var l=$("#filemin-tree .tree").data("ui-fancytree").getTree();var c=o.path;var d=l.getNodeByKey(c);if(d!==null){d.setActive(true,{noEvents:true});d.makeVisible();d.setExpanded(true,{noAnimation:true})}}else{i.width(n);$(t+" .filemin-table").height(s);$(t+" .filemin-table .list-table").bootstrapTable("resetView",{height:s})}$("#bottom-stats").html(text.toolbar_files+": "+o.stats.files+" | "+text.toolbar_folders+": "+o.stats.dirs+" | "+text.toolbar_total+": "+o.stats.total+" | "+o.stats.size);break}}