function rename(e,t){bootbox.prompt({title:text.rename,value:t,size:"small",buttons:{confirm:{label:text.dialog_ok,className:"btn-primary"},cancel:{label:text.dialog_cancel,className:"btn-default pull-right"}},callback:function(a){if(a!==null){$.post("rename.cgi",{path:e.path,file:t,name:a}).done(function(t){if(t.success){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{showError(text.error_rename,t.error)}}).fail(function(e,t,a){showError(t.error_title,t)})}}})}function createFile(e){bootbox.prompt({title:text.provide_new_file_name,value:"",size:"small",buttons:{confirm:{label:text.dialog_ok,className:"btn-primary"},cancel:{label:text.dialog_cancel,className:"btn-default pull-right"}},callback:function(t){if(t!==null){$.post("create_file.cgi",{path:e.path,name:t}).done(function(a){if(a.success){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{showError(text.error_create+" "+t,a.error)}}).fail(function(e,t,a){showError(null,t)})}}})}function createFolder(e){bootbox.prompt({title:text.provide_folder_name,value:"",size:"small",buttons:{confirm:{label:text.dialog_ok,className:"btn-primary"},cancel:{label:text.dialog_cancel,className:"btn-default pull-right"}},callback:function(t){if(t===null){}else{$.post("create_folder.cgi",{path:e.path,name:t}).done(function(a){if(a.success){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{showError(text.error_create+" "+t,a.error)}}).fail(function(e,t,a){showError(null,t)})}}})}function copySelected(e,t){var a=$(e.id+" .list-table").bootstrapTable("getAllSelections");var o;if(a.length===0&&t===undefined){}else{if(a.length>0){o=a.map(function(t){return e.path+"/"+t.name})}else{o=[e.path+"/"+t]}$.post("copy.cgi",{path:e.path,name:o}).done(function(e){if(e.success){showSuccess(null,e.text)}else{showError(text.error_copy,e.error)}}).fail(function(e,t,a){showError(null,t)})}}function cutSelected(e,t){var a=$(e.id+" .list-table").bootstrapTable("getAllSelections");var o;if(a.length===0&&t===undefined){}else{if(a.length>0){o=a.map(function(t){return e.path+"/"+t.name})}else{o=[e.path+"/"+t]}$.post("cut.cgi",{path:e.path,name:o}).done(function(e){if(e.success){showSuccess(null,e.text)}else{showError(text.error_cut,e.error)}}).fail(function(e,t,a){showError(null,t)})}}function paste(e){var t=showWait(text.paste,text.notice_take_while);$.post("paste.cgi",{path:e.path}).done(function(a){if(a.error){waitToError(t,text.error_title,a.error)}else{waitToSuccess(t,text.notice_success,a.text)}$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}).fail(function(e,a,o){waitToError(t,a.error_title,a)})}function extract(e,t){var a=showWait(text.extraction_started);$.post("extract.cgi",{path:e.path,file:t}).done(function(o){if(o.success){waitToSuccess(a,text.extraction_complete,t);$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{waitToError(a,text.error_extract,o.error)}}).fail(function(e,t,o){waitToError(a,null,t)})}function listArchive(e,t){var a=showWait(text.table_LoadingMessage);$.post("list_archive.cgi",{path:e,file:t}).done(function(e){if(e.success){bootbox.dialog({title:t,message:'<pre class="well">'+e.success+"</pre>",size:"large",onEscape:true,buttons:{cancel:{label:text.dialog_ok,className:"btn-primary"}}});$("pre.well").height($(window).height()-273);a.remove()}else{waitToError(a,null,e.error)}}).fail(function(e,t,o){waitToError(a,null,t)})}function pasteSymlink(e){$.post("symlink.cgi",{path:e.path}).done(function(t){if(t.success){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{showError(null,t.error)}}).fail(function(e,t,a){showError(null,t)})}function deleteSelected(e,t){var a=$(e.id+" .list-table").bootstrapTable("getAllSelections");var o;var l="";if(a.length>0){o=a.map(function(e){return e.name})}else{o=[t]}$.each(o,function(e,t){l+="<li>"+escapeHTML(t)+"</li>"});bootbox.confirm({title:text.delete,message:text.about_to_delete+"<ul>"+l+"</ul>"+text.are_you_sure,className:"modal-500",buttons:{confirm:{label:text.delete,className:"btn-danger"},cancel:{label:text.dialog_cancel,className:"btn-default pull-right"}},callback:function(t){if(t){$.post("delete.cgi",{path:e.path,name:o}).done(function(t){if(t.success){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{showError(text.error_delete,t.error)}}).fail(function(e,t,a){showError(null,t)})}}})}function bookmark(e){$.post("bookmark.cgi",{path:e.path}).done(function(t){if(t.success){$("#bookmarks").append('<li><a data-item="goto">'+escapeHTML(e.path)+"</a></li>");showSuccess(null,text.bookmark_added)}else{showError(null,t.error)}}).fail(function(e,t,a){showError(null,t)})}function convertTimestamp(e){var t=new Date(e*1e3),a=t.getFullYear(),o=("0"+(t.getMonth()+1)).slice(-2),l=("0"+t.getDate()).slice(-2),i=t.getHours(),n=i,r=("0"+t.getMinutes()).slice(-2),s="AM",c;if(i>12){n=i-12;s="PM"}else if(i===12){n=12;s="PM"}else if(i===0){n=12}c=a+"-"+o+"-"+l+", "+n+":"+r+" "+s;return c}function bytesToSize(e){var t=["B","KB","MB","GB","TB"];if(e===0)return"0 B";var a=parseInt(Math.floor(Math.log(e)/Math.log(1024)));var o;if(a===0){o=e/Math.pow(1024,a)}else{o=(e/Math.pow(1024,a)).toFixed(2)}o+=" "+t[a];return o}function getQueryPathParam(e){var t=e.split("?")[1]?e.split("?")[1]:"";var a=t.split("&");var o={};for(i=0;i<a.length;i++){o[a[i].split("=")[0]]=decodeURIComponent(a[i].split("=")[1])}return o.path?o.path:""}function toggleChmod(e){$(e.form).find("table :input").attr("disabled",!e.checked)}function toggleChown(e){$(e.form).find(".panel :input").attr("disabled",!e.checked)}function changeProperties(e,t){var a=$(e.id+" .list-table").bootstrapTable("getAllSelections");var o=$('<form class="form-inline" name="properties"/>')[0];$(o).html($("#propertiesDialog form[name=properties]").html());var l;if(a.length===0){o.permissions.value=t.permissions;o.owner.value=t.user;o.group.value=t.group;o.name.value=t.name;octalchange(o.permissions);a=[t];if(!t.directory){$(o.getsize).hide()}$(o).find(".obj-name i").html(t.name);$(o).find(".type i").html(t.type);$(o).find(".stats").hide();$(o).find(".size i").html(bytesToSize(t.size));$(o).find(".modified i").html(convertTimestamp(t.mtime));$(o).find(".accessed i").html(convertTimestamp(t.atime));l="<b>"+text.properties_of+"</b> <i>"+escapeHTML(t.name)+"</i>"}else{var i=countStats(a);if(i.dirs===0){$(o.getsize).hide()}$(o).find(".obj-name").hide();$(o).find(".type").hide();$(o).find(".stats i").html(text.toolbar_files+": "+i.files+" - "+text.toolbar_folders+": "+i.dirs+" - "+text.toolbar_total+": "+i.total);$(o).find(".size i").html(i.size);$(o).find(".modified").hide();$(o).find(".accessed").hide();l="<b>"+text.properties+"</b>"}o.path.value=e.path;octalchange(o.permissions);$(o).find("table :input").attr("disabled",true);$(o).find(".panel :input").attr("disabled",true);$(o).find(".path i").html(escapeHTML(e.path));bootbox.dialog({title:l,message:o,onEscape:true,buttons:{confirm:{label:text.dialog_change,className:"btn-primary",callback:function(){names=a.map(function(e){return{name:"name",value:e.name}});data=$(o).serializeArray();$.post("change_properties.cgi",data.concat(names)).done(function(t){if(t.success){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{showError(null,t.error)}}).fail(function(e,t,a){showError(null,t)})}},cancel:{label:text.dialog_cancel,className:"btn-default"}}})}function chmodSelected(e,t){var a=$(e.id+" .list-table").bootstrapTable("getAllSelections");var o=$("<form/>")[0];$(o).html($("#chmodDialog form[name=chmod]").html());o.path.value=e.path;if(a.length===0){o.permissions.value=t.permissions;octalchange(o.permissions);a=[t]}bootbox.dialog({title:text.chmod_selected,message:o,onEscape:true,buttons:{confirm:{label:text.dialog_change,className:"btn-primary",callback:function(){var t;t=a.map(function(e){return{name:"name",value:e.name}});data=$(o).serializeArray();$.post("chmod.cgi",data.concat(t)).done(function(t){if(t.success){$(e.id+" .list-table").bootstrapTable("refresh")}else{showError(text.error_chmod,t.error)}}).fail(function(e,t,a){showError(null,t)})}},cancel:{label:text.dialog_cancel,className:"btn-default"}}})}function chownSelected(e,t){var a=$(e.id+" .list-table").bootstrapTable("getAllSelections");var o=$("<form/>")[0];$(o).html($("#chownDialog form[name=chown]").html());o.path.value=e.path;if(a.length===0){o.owner.value=t.user;o.group.value=t.group;a=[t]}bootbox.dialog({title:text.chown_selected,message:o,onEscape:true,buttons:{confirm:{label:text.dialog_change,className:"btn-primary",callback:function(){var t;t=a.map(function(e){return{name:"name",value:e.name}});data=$(o).serializeArray();$.post("chown.cgi",data.concat(t)).done(function(t){if(t.success){$(e.id+" .list-table").bootstrapTable("refresh")}else{showError(text.error_chown,t.error)}}).fail(function(e,t,a){showError(null,t)})}},cancel:{label:text.dialog_cancel,className:"btn-default"}}})}function compressSelected(e,t){var a=$(e.id+" .list-table").bootstrapTable("getAllSelections");var o=$('<form class="form-inline"/>')[0];$(o).html($("#compressDialog form[name=compress]").html());o.path.value=e.path;if(a.length===0){a=[t]}bootbox.dialog({title:text.compress_selected,message:o,className:"modal-400",onEscape:true,buttons:{confirm:{label:text.dialog_compress,className:"btn-primary",callback:function(){var t;t=a.map(function(e){return{name:"name",value:e.name}});data=$(o).serializeArray();$.post("compress.cgi",data.concat(t)).done(function(t){if(t.success){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{showError(text.error_compress,t.error)}}).fail(function(e,t,a){showError(null,t)})}},cancel:{label:text.dialog_cancel,className:"btn-default"}}})}function checkSelected(e){return $(e.id+" .list-table").bootstrapTable("getAllSelections").length>0}function getSize(e){$(e).prop("disabled",true);$.post("get_size.cgi",{name:e.form.name.value,path:e.form.path.value}).done(function(t){if(t.success){$(e.form).find(".size i").html(bytesToSize(t.data));$(e).fadeOut("200")}else{showError(null,t.error)}}).fail(function(e,t,a){showError(null,t)})}function getFromUrl(e){var t=$("<form/>")[0];$(t).html($("#downFromUrlDialog form[name='down_from_url']").html());t.path.value=e.path;bootbox.dialog({title:text.chown_selected,message:t,onEscape:true,buttons:{confirm:{label:text.get_from_url,className:"btn-primary",callback:function(){var a=$(t).serialize();var o=t.link.value;var l=new XMLHttpRequest;l.open("POST","http_download.cgi",true);var i=new PNotify({title:text.http_downloading,text:"",icon:"fa fa-spinner fa-spin",hide:false,buttons:{closer:false,sticker:false},history:{history:false}});l.onprogress=function(){i.update({text:l.responseText})};l.onreadystatechange=function(){if(l.readyState==4){if(l.status!=200){i.update({type:"error",hide:true,icon:"fa fa-exclamation-triangle",title:text.error_title,text:l.statusText,buttons:{closer:true}})}else{var t;try{t=JSON.parse(l.responseText)}catch(a){t='{"success" : 1}'}if(t.error){i.update({type:"notice",hide:true,icon:"fa fa-exclamation-circle",title:text.warning_title,text:t.error,buttons:{closer:true}})}else{i.update({type:"success",hide:true,icon:"fa fa-check-circle",title:text.http_download_complete,text:o,buttons:{closer:true}})}var n="list.cgi?path="+encodeURIComponent(e.path);if($(e.id+" .list-table").bootstrapTable("getOptions").url==n){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+e.path})}}}};l.send(a)}},cancel:{label:text.dialog_cancel,className:"btn-default"}}})}function manageBookmarks(){var e=$("<form/>")[0];$(e).html($("#bookmarksDialog form[name='manage-bookmarks']").html());$.ajax({url:"get_bookmarks.cgi",dataType:"text",type:"GET",async:true}).done(function(t){var a;try{a=JSON.parse(t)}catch(o){a={success:1}}if(a.success){e.bookmarks.value=t}else{showError(null,a.error)}}).fail(function(e,t,a){showError(null,t)});bootbox.dialog({title:text.manage_bookmarks,className:"modal-500",message:e,onEscape:true,buttons:{confirm:{label:text.dialog_save,className:"btn-primary",callback:function(){e.bookmarks.value=e.bookmarks.value.replace(/^\s*[\r\n]/gm,"");data=$(e).serializeArray();$.post("save_bookmarks.cgi",data).done(function(t){if(t.success){showSuccess(null,text.saved_successfully);var a=e.bookmarks.value.split("\n");var o=$("#bookmarks");var l=o.children();$.each(l.slice(3,l.length),function(e,t){t.remove()});$.each(a,function(e,t){if(t!==""){$(o).append('<li><a data-item="goto">'+t+"</a><li>")}})}else{showError(null,t.error)}}).fail(function(e,t,a){showError(null,t)})}},cancel:{label:text.dialog_cancel,className:"btn-default"}}})}function editFile(e,t,a){var o=showWait(text.table_LoadingMessage);$.ajax({url:"get_file_contents.cgi?path="+encodeURIComponent(e)+"&name="+encodeURIComponent(t),dataType:"text",type:"GET",async:true}).done(function(l){var i=l;if(true){var n=a;$("#tabs-control").append($('<li><a class="closable" data-toggle="tab" aria-controls="editor-'+n+'" href="#editor-'+n+'"><i class="fa fa-edit"></i> '+escapeHTML(t)+' <button class="btn btn-xs btn-success close-tab pull-right" type="button" '+'title="'+text.close_tab+'"><i class="fa fa-close"></i></button>'+"</a></li>"));var r=$("#tabs-control").find('a[href="#editor-'+n+'"]');$(r).attr("data-original-title",escapeHTML(e+"/"+t)).tooltip({trigger:"hover",placement:"bottom",html:true});$("#tabs-container").append($('                    <div class="tab-pane fade filemin-tab" id="editor-'+n+'">                        <form name="edit-file">                            <div class="form-group">                                <textarea name="data" class="form-control" rows="20">'+$("<div/>").text(l).html()+'</textarea>                            </div>                            <input type="hidden" name="path" value="">                            <input type="hidden" name="name" value="">                            <input class="btn btn-primary" type="button" name="save" value="'+text.save+'">'+buildModeSelector()+"</form>                    </div>"));var s=$("#editor-"+n+' form[name="edit-file"]')[0];s.path.value=e;s.name.value=t;var c=CodeMirror.fromTextArea(s.data,{mode:"scheme",lineNumbers:true,viewportMargin:Infinity,autoRefresh:true});c.on("change",function(e,t){$('a[href="#editor-'+n+'"]').find("button").removeClass("btn-success").addClass("btn-danger")});$("#editor-"+n+" .CodeMirror").height($(window).height()-163);var d=CodeMirror.findModeByExtension(t.split(".").pop());if(d){mode=d.mode;mime=d.mime;c.setOption("mode",mime);CodeMirror.autoLoadMode(c,mode);$("#editor-"+n+' select[name="mode-list"]').val(mime)}else{c.setOption("mode","scheme");$("#editor-"+n+' select[name="mode-list"]').val("text/plain")}$("#editor-"+n+' select[name="mode-list"]').selectpicker({style:"btn-info",size:10,dropupAuto:false}).on("change",function(){var e=CodeMirror.findModeByMIME(this.value);mode=e.mode;spec=e.mime;c.setOption("mode",spec);CodeMirror.autoLoadMode(c,mode)});s.editor=c;$('a[href="#editor-'+n+'"]').tab("show");o.remove()}else{waitToError(o,null,i.error)}}).fail(function(e,t,a){waitToError(o,null,t)})}function downloadSelected(e,t){var a=$(e.id+" .list-table").bootstrapTable("getAllSelections");var o=$('<form class="form-inline"/>')[0];$(o).html($("#compressDialog form[name=compress]").html());o.path.value=e.path;if(a.length===0&&!t.directory){window.location.href="download.cgi?path="+encodeURIComponent(e.path)+"&file="+encodeURIComponent(t.name)}else{var l;if(a.length===0){a=[t];l=t.name}else{dirs=e.path.split("/");l=dirs[dirs.length-1]}o.archivename.value=l;bootbox.dialog({title:text.compress_selected,message:o,className:"modal-400",onEscape:true,buttons:{confirm:{label:text.dialog_compress,className:"btn-primary",callback:function(){var e;e=a.map(function(e){return{name:"name",value:e.name}});data=$(o).serializeArray();data=data.concat(e);var t=$.param(data);window.location.href="download_multi.cgi?"+t;showNotice(text.preparing_download)}},cancel:{label:text.dialog_cancel,className:"btn-default"}}})}}function viewImage(e,t){bootbox.dialog({title:t,message:'<img class="img-responsive" src="get_img.cgi?path='+encodeURIComponent(e)+"&name="+encodeURIComponent(t)+'"/>',size:"large",className:"text-center",onEscape:true,buttons:{cancel:{label:text.dialog_ok,className:"btn-primary"}}})}function editSymlink(e,t){bootbox.prompt({title:text.edit_symlink,value:t.link_target,size:"small",buttons:{confirm:{label:text.dialog_ok,className:"btn-primary"},cancel:{label:text.dialog_cancel,className:"btn-default pull-right"}},callback:function(a){if(a!==null){$.post("update_symlink.cgi",{path:e.path,name:t.name,link:a}).done(function(t){if(t.success){$(e.id+" .list-table").bootstrapTable("refresh",{url:"list.cgi?path="+encodeURIComponent(e.path)})}else{showError(text.error_symlink,t.error)}}).fail(function(e,t,a){showError(null,t)})}}})}function search(e){var t=$('<form name="search"/>')[0];$(t).html($("#searchDialog form[name=search]").html());t.path.value=e;bootbox.dialog({title:text.search,message:t,onEscape:true,buttons:{confirm:{label:text.search_go,className:"btn-primary",callback:function(){var a="list.cgi?path="+encodeURIComponent(e)+"&query="+encodeURIComponent(t.query.value)+"&caseins="+t.caseins.value;filemin.newTab("search",a)}},cancel:{label:text.dialog_cancel,className:"btn-default"}}})}function escapeHTML(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}function showSuccess(e,t){new PNotify({icon:"fa fa-check-circle",type:"success",title:e?e:text.notice_success,text:t?escapeHTML(t):""})}function showNotice(e,t){new PNotify({icon:"fa fa-exclamation-circle",type:"notice",title:e?e:text.warning_title,text:t?escapeHTML(t):""})}function showError(e,t){new PNotify({icon:"fa fa-exclamation-triangle",type:"error",title:e?e:text.error_title,text:t?escapeHTML(t):""})}function showWait(e,t){return new PNotify({icon:"fa fa-cog fa-spin",type:"notice",hide:false,title:e?e:text.notice_wait,text:t?escapeHTML(t):""})}function waitToSuccess(e,t,a){e.update({type:"success",hide:true,icon:"fa fa-check-circle",title:t?t:text.notice_success,text:a?escapeHTML(a):"",buttons:{closer:true}})}function waitToError(e,t,a){e.update({type:"error",hide:true,icon:"fa fa-exclamation-circle",title:t?t:a.error_title,text:a?a:"",buttons:{closer:true}})}function countStats(e){var t=e.length;var a=e.filter(function(e){return e.directory}).length;var o=t-a;var l=0;$.each(e,function(e,t){l+=t.size});l=bytesToSize(l);return{total:t,dirs:a,files:o,size:l}}function buildModeSelector(){result='<select name="mode-list" class="selectpicker dropup" data-live-search="true">';var e=CodeMirror.modeInfo;$.each(e,function(e,t){result+='<option value="'+t.mime+'">'+t.name+"</option>"});result+="</select>";return result}function isEditable(e,t){if(e.indexOf("inode")>-1){return false}if(e.indexOf("text")>-1){return true}var a=CodeMirror.findModeByMIME(e);if(!a){a=CodeMirror.findModeByExtension(t.split(".").pop())}return a?true:false}function disableForSearch(){$('#main-menu .nav li a[data-item="create_file"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="create_folder"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="upload_files"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="get_from_url"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="paste"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="symlink"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="get_sizes"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="compress_selected"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="search"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="bookmark"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="goto"]').parent().addClass("disabled")}function disableForEdit(){$('#main-menu .nav li a[data-item="create_file"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="create_folder"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="upload_files"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="get_from_url"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="copy_selected"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="cut_selected"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="paste"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="symlink"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="get_sizes"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="chmod_selected"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="chown_selected"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="compress_selected"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="search"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="bookmark"]').parent().addClass("disabled");$('#main-menu .nav li a[data-item="goto"]').parent().addClass("disabled")}